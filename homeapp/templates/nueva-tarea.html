{% extends 'base.html' %}
 
{% block content %}

<!-- Modal de edición de la tarea -->
<div class="modal fade" id="editarModal_{{ tarea.id }}" tabindex="-1" aria-labelledby="editarModalLabel_{{ tarea.id }}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content bg-annapolis-blue rounded-10">
            <div class="modal-header">
                <h5 class="modal-title" id="editarModalLabel_{{ tarea.id }}">Editar Tarea: {{ tarea.name }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'editar_tarea' tarea.id %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="title" class="form-label">Título de la tarea</label>
                        <input type="text" class="form-control" id="title" name="title" value="{{ tarea.name }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Descripción</label>
                        <textarea class="form-control" id="description" name="description" required>{{ tarea.description }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="start-date" class="form-label">Fecha de inicio</label>
                        <input type="date" class="form-control" id="start-date" name="start-date" value="{{ tarea.start_date }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="end-date" class="form-label">Fecha de finalización</label>
                        <input type="date" class="form-control" id="end-date" name="end-date" value="{{ tarea.end_date }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="presupuesto" class="form-label">Presupuesto</label>
                        <input type="number" class="form-control" id="presupuesto" name="presupuesto" value="{{ tarea.budget }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="status" class="form-label">Estado</label>
                        <select class="form-control" id="status" name="status">
                            {% for status in status_list %}
                                <option value="{{ status.id }}" {% if tarea.status.id == status.id %}selected{% endif %}>{{ status.status }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn bg-distant-horizon text-midnight-express">Crear tarea</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

    <script>
        document.querySelector('#formTask').addEventListener('submit', function(event) {
            // Variables de validación
            var isValid = true;
            var errorMessage = '';
        
            // Obtener los valores de los campos
            var title = document.getElementById('title').value.trim();
            var presupuesto = document.getElementById('presupuesto').value.trim();
            var description = document.getElementById('description').value.trim();
            var startDate = document.getElementById('start-date').value;
            var endDate = document.getElementById('end-date').value;
        
            // Validar que ningún campo esté vacío
            if (title === '' || presupuesto === '' || description === '' || startDate === '' || endDate === '') {
                isValid = false;
                errorMessage += 'Ningún campo debe estar vacío.\n';
            }
        
            // Validar el título (entre 5 y 20 caracteres)
            if (title.length < 5 || title.length > 20) {
                isValid = false;
                errorMessage += 'El título debe tener entre 5 y 20 caracteres.\n';
            }
        
            // Validar la descripción (entre 5 y 80 caracteres)
            if (description.length < 5 || description.length > 80) {
                isValid = false;
                errorMessage += 'La descripción debe tener entre 5 y 80 caracteres.\n';
            }
        
            // Validar el presupuesto (número positivo, con o sin decimales)
            var presupuestoPattern = /^[0-9]+(\.[0-9]{1,2})?$/;
            if (!presupuestoPattern.test(presupuesto) || parseFloat(presupuesto) <= 0) {
                isValid = false;
                errorMessage += 'El presupuesto debe ser un número positivo mayor a 0, con hasta dos decimales.\n';
            }
        
            // Validar formato de fechas (DD/MM/YYYY)
            var datePattern = /^\d{4}-\d{2}-\d{2}$/; // Formato de fecha en HTML5 (YYYY-MM-DD)
            if (!datePattern.test(startDate)) {
                isValid = false;
                errorMessage += 'La fecha de inicio debe tener el formato DD/MM/YYYY.\n';
            }
            if (!datePattern.test(endDate)) {
                isValid = false;
                errorMessage += 'La fecha de finalización debe tener el formato DD/MM/YYYY.\n';
            }
       
            // Validar que la fecha de finalización sea posterior a la fecha de inicio
            if (endDate <= startDate) {
                isValid = false;
                errorMessage += 'La fecha de finalización debe ser posterior a la fecha de inicio.\n';
            }
        
            // Si alguna validación falla, mostrar mensaje de error y prevenir el envío
            if (!isValid) {
                event.preventDefault();  // Solo prevenir si hay un error
                alert(errorMessage);
            }
        });
        
        </script>



{% endblock %}
